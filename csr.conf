# =====================================================================
# Fichier de configuration OpenSSL pour une Certificate Signing Request (CSR)
# Destiné à un serveur d'API Kubernetes
# =====================================================================

[ req ]
# Spécifie les options par défaut pour la création de la requête.
default_bits       = 2048                # Taille de la clé privée en bits (2048 est un bon standard)
prompt             = no                  # Ne pas poser de questions interactives ; utiliser les valeurs de [dn]
default_md         = sha256              # Algorithme de hachage pour la signature
req_extensions     = req_ext             # Section contenant les extensions X.509 v3 à inclure dans la CSR
distinguished_name = dn                  # Section contenant les informations du "Distinguished Name"

[ dn ]
# Informations d'identification du certificat.
# CORRIGÉ : Remplacement des valeurs génériques par des valeurs spécifiques.
C  = TN                        # Pays (Code à 2 lettres)
ST = Mahdia                     # État ou Province
L  = Mareth                    # Localité ou Ville
O  = MonOrganisation           # Nom de l'organisation
OU = Equipe Kubernetes         # Unité Organisationnelle
CN = kubernetes.default.svc.cluster.local # Common Name (Nom Commun)

[ req_ext ]
# Cette section est utilisée pour inclure les extensions dans la CSR elle-même.
# C'est essentiel pour que l'Autorité de Certification (CA) connaisse les SANs demandés.
subjectAltName = @alt_names

[ alt_names ]
# Subject Alternative Names (SANs). Essentiel pour les certificats TLS modernes.
# Permet au certificat d'être valide pour plusieurs noms DNS et adresses IP.
DNS.1 = kubernetes
DNS.2 = kubernetes.default
DNS.3 = kubernetes.default.svc
DNS.4 = kubernetes.default.svc.cluster
DNS.5 = kubernetes.default.svc.cluster.local
IP.1  = 192.168.49.2           # Adresse IP du nœud master ou du load balancer
IP.2  = 10.96.0.1              # Adresse IP du service (ClusterIP) de l'API Kubernetes

[ v3_ext ]
# Cette section définit les extensions pour un certificat final (pas pour la CSR).
# Elle est typiquement utilisée lors de la création d'un certificat auto-signé
# avec la commande "openssl req -x509 -extensions v3_ext ...".
# Elle n'est PAS utilisée lors de la simple génération d'une CSR ("openssl req -new ...").
authorityKeyIdentifier = keyid,issuer:always
basicConstraints       = CA:FALSE
keyUsage               = keyEncipherment, dataEncipherment
extendedKeyUsage       = serverAuth, clientAuth
subjectAltName         = @alt_names
